import{A as R,B as gt,C as xt,D as _t,E as V,F as z,H as Ct,K as wt,L as It,M as St,O as bt,P as x,a as at,f as ct,g as mt,h as lt,i as pt,j as X,k as dt,l as ut,m as O,n as M,o as G,p as H,r as D,s as q,t as A,v as ht,w,x as ft,y as vt}from"./chunk-CBCO7BFG.js";import{Bb as y,Db as h,Eb as d,Fc as ot,Gc as C,Hb as B,Hc as rt,Ib as it,Lc as st,Nb as K,Ob as p,Pb as N,Qb as U,R as Q,Rb as nt,Sa as L,Va as a,Wa as u,X as tt,Y as k,aa as et,bc as Y,fa as g,ga as F,ib as f,kb as m,nb as P,pa as b,qa as E,vb as s,wb as c,xb as l,yb as j,zb as T}from"./chunk-6W7VELQ7.js";var W={apiKEY:"Bearer nNzf3q8GYnGxdY2B55WyNbEUPESfktLX"};var _=(()=>{let e=class e{constructor(t){this.http=t,this.token=""}getCookie(){let t=document.cookie.match(new RegExp("(^| )XSRF-TOKEN=([^;]+)"));return t?{headers:{"X-XSRF-TOKEN":decodeURIComponent(t[2]),Accept:"application/json"},withCredentials:!0}:new Error}getSubjects(){return this.http.get("/api/subjects",this.getCookie())}getExercise(t){return this.http.post("/api/exercise",t,this.getCookie())}toAnswer(t,i){return this.http.post("/api/answer",t,this.getCookie())}logOut(){return this.http.post("/logout",{},this.getCookie())}chatWithIA(t){let i={model:"mistral-small-latest",messages:[{role:"user",content:t}]};return this.http.post("https://api.mistral.ai/v1/chat/completions",i,{headers:{"Content-Type":"application/json",Authorization:W.apiKEY}})}storeChats(t){return this.http.post("/api/chats",t,this.getCookie())}extractTopics(t){let i={model:"mistral-small-latest",messages:[{role:"user",content:"A quale branca appartiene '"+t+"?' ignora la domanda in se e rispondi con una parola e in maniera pi\xF9 specifica possibile nell'ambito della materia"}]};return this.http.post("https://api.mistral.ai/v1/chat/completions",i,{headers:{"Content-Type":"application/json",Authorization:W.apiKEY}})}storeStats(t){return this.http.post("/api/stats",t,this.getCookie())}changePsw(t){return this.http.post("/forgot-password",t,this.getCookie())}};e.\u0275fac=function(i){return new(i||e)(et(at))},e.\u0275prov=tt({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Et=(()=>{let e=class e{constructor(t,i,o,v){this.auth=t,this.router=i,this.studentService=o,this.errorHandler=v,this.switchClass=!0,this.activeElement=0}switcher(t){this.switchClass=!this.switchClass,t.target.blur()}setActive(t){this.activeElement=t}logOut(){this.studentService.logOut().subscribe({next:t=>{this.auth.setUser(""),this.router.navigate(["/login"])},error:t=>this.errorHandler.handle(t)})}};e.\u0275fac=function(i){return new(i||e)(u(dt),u(lt),u(_),u(x))},e.\u0275cmp=g({type:e,selectors:[["app-home-student"]],decls:31,vars:4,consts:[["slimTitle","Ministero dell'Istruzione e del Merito","slimTitleLink","https://www.miur.gov.it/","showSearch","false"],["slimRightZone","","mode","nav"],["button",""],["name","user","color","white","size","xl"],["list",""],[3,"click"],["name","logout"],["brand",""],["href","#"],["name","pa"],[1,"it-brand-text"],[1,"it-brand-title"],[1,"it-brand-tagline","d-none","d-md-block"],["navItems",""],["routerLink","compiti","aria-current","page",3,"click"],["name","bookmark","color","white"],["aria-current","page","routerLink","chat",3,"click"],["name","comment","color","white"]],template:function(i,o){i&1&&(s(0,"div")(1,"div")(2,"it-header",0)(3,"it-dropdown",1)(4,"span",2),l(5,"it-icon",3),c(),j(6,4),s(7,"it-dropdown-item",5),h("click",function(){return o.logOut()}),l(8,"it-icon",6),p(9," Log Out"),c(),T(),c(),j(10,7),s(11,"a",8),l(12,"it-icon",9),s(13,"div",10)(14,"div",11),p(15,"Tipo di Istituto"),c(),s(16,"div",12),p(17,"Nome della Scuola"),c()()(),T(),j(18,13),s(19,"it-navbar-item")(20,"a",14),h("click",function(S){return o.switcher(S)}),s(21,"span"),l(22,"it-icon",15),p(23," Compiti"),c()()(),s(24,"it-navbar-item")(25,"a",16),h("click",function(S){return o.switcher(S)}),s(26,"span"),l(27,"it-icon",17),p(28," Chat"),c()()(),T(),c()(),s(29,"div"),l(30,"router-outlet"),c()()),i&2&&(a(20),P(o.switchClass?"nav-link active":"nav-link"),a(5),P(o.switchClass?"nav-link":"nav-link  active"))},dependencies:[mt,pt,vt,ft,St,It,w]});let n=e;return n})();function Ot(n,e){if(n&1){let r=y();s(0,"it-list-item",4),h("click",function(){let i=b(r).$implicit,o=d();return E(o.noExercise(i.id_exercise))}),s(1,"span",5),p(2),c(),l(3,"it-icon",6),c()}if(n&2){let r=e.$implicit;it("href","/studenti/compiti/",r.id_exercise,""),a(2),N(r.name)}}var kt=(()=>{let e=class e{constructor(t,i,o){this.studentService=t,this.errorHandler=i,this.notificationService=o}ngOnInit(){this.studentService.getSubjects().subscribe({next:t=>this.subjects=t.subs,error:t=>this.errorHandler.handle(t)})}noExercise(t){t==null&&this.notificationService.info("Notifica Info","Non ci sono esercizi.")}};e.\u0275fac=function(i){return new(i||e)(u(_),u(x),u(V))},e.\u0275cmp=g({type:e,selectors:[["app-homework"]],decls:4,vars:1,consts:[[1,"d-flex","justify-content-center"],["navItems","",1,"w-75"],["externalLink","false",3,"href","click",4,"ngFor","ngForOf"],["dismmisable","true"],["externalLink","false",3,"click","href"],[1,"text"],["name","chevron-right","color","primary"]],template:function(i,o){i&1&&(s(0,"div",0)(1,"it-list",1),f(2,Ot,4,3,"it-list-item",2),c()(),l(3,"it-notifications",3)),i&2&&(a(2),m("ngForOf",o.subjects))},dependencies:[C,xt,_t,z,w]});let n=e;return n})();function Gt(n,e){if(n&1&&(s(0,"div",8),l(1,"div",9),s(2,"it-card",10)(3,"h3",11),p(4),c()(),l(5,"div",9),c()),n&2){let r=e.$implicit,t=e.index;a(),m("ngClass",t%2==0?"none":"arrow-left"),a(3),N(r),a(),m("ngClass",t%2==0?"arrow-right":"none")}}var Ft=(()=>{let e=class e{constructor(t,i){this.studentsService=t,this.errorHandler=i,this.studentChat=[],this.aiChat=[],this.chats=[],this.chatForm=new G({message:new H("")})}ngOnInit(){}sendMessage(){let t={message:this.chatForm.value.message};this.chats.push(this.chatForm.value.message),this.studentsService.chatWithIA(this.chatForm.value.message).subscribe({next:i=>this.chats.push(i.choices[0].message.content),error:i=>this.errorHandler.handle(i)}),this.studentsService.storeChats(t).subscribe({next:i=>this.ngOnInit(),error:i=>this.errorHandler.handle(i)}),this.studentsService.extractTopics(this.chatForm.value.message).subscribe(i=>{let v={name:i.choices[0].message.content};this.studentsService.storeStats(v).subscribe(S=>console.log(S))}),this.chatForm.value.message=""}};e.\u0275fac=function(i){return new(i||e)(u(_),u(x))},e.\u0275cmp=g({type:e,selectors:[["app-chat"]],decls:9,vars:3,consts:[["id","outer",1,"d-flex","flex-column"],["id","dialogs",1,"d-flex","align-items-center","flex-column"],["class","d-flex justify-content-center w-75",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center"],[3,"formGroup"],["label","Scrivi la tua domanda","formControlName","message"],["name","pencil","size","sm","color","primary","prependText",""],["itButton","primary","append","","type","submit",3,"click","disabled"],[1,"d-flex","justify-content-center","w-75"],[3,"ngClass"],["space","true","background","true"],[1,"card-title","h5"]],template:function(i,o){i&1&&(s(0,"div",0)(1,"div",1),f(2,Gt,6,3,"div",2),c(),s(3,"div",3)(4,"form",4)(5,"it-input",5),l(6,"it-icon",6),s(7,"button",7),h("click",function(){return o.sendMessage()}),p(8,"Invia"),c()()()()()),i&2&&(a(2),m("ngForOf",o.chats),a(2),m("formGroup",o.chatForm),a(3),m("disabled",!o.chatForm.valid))},dependencies:[ot,C,R,gt,Ct,w,D,O,M,q,A],styles:["#outer[_ngcontent-%COMP%]{height:75vh}#sidebar[_ngcontent-%COMP%]{width:20%;position:absolute}#dialogs[_ngcontent-%COMP%]{margin-top:10px;height:90%;overflow-y:scroll}it-card[_ngcontent-%COMP%]{width:60%;margin-top:10px}.arrow-left[_ngcontent-%COMP%]{margin-top:10px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-right:10px solid hsl(210,100%,40%)}.arrow-right[_ngcontent-%COMP%]{margin-top:10px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:10px solid hsl(210,100%,40%)}.none[_ngcontent-%COMP%]{display:none}"]});let n=e;return n})();function Ht(n,e){}function Dt(n,e){n&1&&f(0,Ht,0,0,"ng-template")}function qt(n,e){if(n&1){let r=y();s(0,"form",8),p(1),l(2,"it-textarea",9),s(3,"button",10),h("click",function(){b(r);let i=d(2).$implicit,o=d();return E(o.toAnswer(i.id))}),p(4,"Invia"),c()()}if(n&2){let r=d(2).$implicit,t=d();m("formGroup",t.questionFormGroups[r.id]),a(),U(" ",r.questions," "),a(),m("rows",5),a(),m("disabled",!t.questionFormGroups[r.id].valid)}}function At(n,e){if(n&1){let r=y();s(0,"form",8),l(1,"img",11)(2,"it-textarea",9),s(3,"button",10),h("click",function(){b(r);let i=d(2).$implicit,o=d();return E(o.toAnswer(i.id))}),p(4,"Invia"),c()()}if(n&2){let r=d(2).$implicit,t=d();m("formGroup",t.questionFormGroups[r.id]),a(),B("src",r.images,L),a(),m("rows",5),a(),m("disabled",!t.questionFormGroups[r.id].valid)}}function Rt(n,e){if(n&1&&f(0,qt,5,4,"form",7)(1,At,5,4,"form",7),n&2){let r=d().$implicit;m("ngIf",r.questions!=null),a(),m("ngIf",r.images!=null)}}function Vt(n,e){if(n&1&&(s(0,"p",13),p(1),c()),n&2){let r=d(2),t=r.$implicit,i=r.index,o=d();a(),nt("Domanda: ",t.questions,", Valutazione: ",o.evaluations[i].evaluation,"")}}function zt(n,e){if(n&1&&(s(0,"p",13),p(1,"Domanda: "),l(2,"img",11),p(3),c()),n&2){let r=d(2),t=r.$implicit,i=r.index,o=d();a(2),B("src",t.images,L),a(),U(", Valutazione: ",o.evaluations[i].evaluation,"")}}function $t(n,e){if(n&1&&f(0,Vt,2,2,"p",12)(1,zt,4,2,"p",12),n&2){let r=d().$implicit;m("ngIf",r.questions!=null),a(),m("ngIf",r.images!=null)}}function Lt(n,e){if(n&1&&(s(0,"div",5),f(1,Dt,1,0,null,6)(2,Rt,2,2,"ng-template",null,0,Y)(4,$t,2,2,"ng-template",null,1,Y),c()),n&2){let r=e.index,t=K(3),i=K(5),o=d();a(),m("ngIf",o.evaluations[r]===null)("ngIfThen",t)("ngIfElse",i)}}var jt=(()=>{let e=class e{constructor(t,i,o,v){this.route=t,this.studentService=i,this.errorHandler=o,this.notificationService=v,this.questionFormGroups={},this.text="Risposta inviata."}ngOnInit(){this.route.params.pipe(Q(t=>this.studentService.getExercise(t))).subscribe({next:t=>{this.questions=t.exercise,t.exercise.forEach(i=>{this.questionFormGroups[i.id.toString()]=new G({answer:new H("",ut.required)})}),this.evaluations=t.evaluations},error:t=>this.errorHandler.handle(t)})}toAnswer(t){let i={id:t,answer:this.questionFormGroups[t].value.answer};this.studentService.toAnswer(i,t).subscribe({next:o=>{this.notificationService.success("Notifica Successo",this.text),this.ngOnInit()},error:o=>this.errorHandler.handle(o)}),this.questionFormGroups[t].value.answer=""}};e.\u0275fac=function(i){return new(i||e)(u(ct),u(_),u(x),u(V))},e.\u0275cmp=g({type:e,selectors:[["app-exercise"]],decls:5,vars:1,consts:[["bloccoIf",""],["bloccoElse",""],[1,"d-flex","align-items-center","flex-column"],["class","d-flex justify-content-center w-100",4,"ngFor","ngForOf"],["dismissible","true"],[1,"d-flex","justify-content-center","w-100"],[4,"ngIf","ngIfThen","ngIfElse"],["class","w-75",3,"formGroup",4,"ngIf"],[1,"w-75",3,"formGroup"],["formControlName","answer",3,"rows"],["itButton","primary","type","submit",3,"click","disabled"],[3,"src"],["class","w-75",4,"ngIf"],[1,"w-75"]],template:function(i,o){i&1&&(s(0,"div",2)(1,"h5"),p(2,"Domande"),c(),f(3,Lt,6,3,"div",3),c(),l(4,"it-notifications",4)),i&2&&(a(3),m("ngForOf",o.questions))},dependencies:[C,rt,R,z,wt,D,O,M,q,A]});let n=e;return n})();var Pt=[{path:"",component:Et,children:[{path:"",redirectTo:"compiti",pathMatch:"full"},{path:"compiti",component:kt},{path:"chat",component:Ft},{path:"compiti/:id",component:jt}]}],Tt=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=F({type:e}),e.\u0275inj=k({imports:[X.forChild(Pt),X]});let n=e;return n})();var Ce=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=F({type:e}),e.\u0275inj=k({imports:[st,Tt,bt.forRoot(),ht]});let n=e;return n})();export{Ce as StudentsModule};
